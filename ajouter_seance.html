<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ajouter une Séance</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }
      .success-message {
        display: none;
        margin-top: 20px;
      }
      #errorMessage {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container py-4">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h1 class="h3 mb-0">Ajouter une nouvelle séance</h1>
            </div>
            <div class="card-body">
              <form id="seanceForm">
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="classe" class="form-label">Classe :</label>
                    <select
                      class="form-select"
                      id="classe"
                      name="classe"
                      required
                    >
                      <option value="">Sélectionner une classe...</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <label for="professeur" class="form-label"
                      >Professeur :</label
                    >
                    <select
                      class="form-select"
                      id="professeur"
                      name="professeur"
                      required
                    >
                      <option value="">Sélectionner un professeur...</option>
                    </select>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="module" class="form-label">Module :</label>
                    <select
                      class="form-select"
                      id="module"
                      name="module"
                      required
                    >
                      <option value="">Sélectionner un module...</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <label for="salle" class="form-label">Salle :</label>
                    <select
                      class="form-select"
                      id="salle"
                      name="salle"
                      required
                    >
                      <option value="">Sélectionner une salle...</option>
                    </select>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-4">
                    <label for="jour" class="form-label">Jour :</label>
                    <select class="form-select" id="jour" name="jour" required>
                      <option value="">Sélectionner un jour...</option>
                      <option value="Lundi">Lundi</option>
                      <option value="Mardi">Mardi</option>
                      <option value="Mercredi">Mercredi</option>
                      <option value="Jeudi">Jeudi</option>
                      <option value="Vendredi">Vendredi</option>
                      <option value="Samedi">Samedi</option>
                    </select>
                  </div>
                  <div class="col-md-4">
                    <label for="heure_debut" class="form-label"
                      >Heure de début :</label
                    >
                    <input
                      type="time"
                      class="form-control"
                      id="heure_debut"
                      name="heure_debut"
                      required
                    />
                  </div>
                  <div class="col-md-4">
                    <label for="heure_fin" class="form-label"
                      >Heure de fin :</label
                    >
                    <input
                      type="time"
                      class="form-control"
                      id="heure_fin"
                      name="heure_fin"
                      required
                    />
                  </div>
                </div>

                <div class="text-center">
                  <button type="submit" class="btn btn-primary">
                    Ajouter la séance
                  </button>
                </div>
              </form>

              <div id="loading" class="loading">Enregistrement en cours...</div>

              <div
                id="successMessage"
                class="alert alert-success success-message"
              >
                La séance a été ajoutée avec succès !
              </div>

              <div id="errorMessage" class="alert alert-danger"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Charger les listes déroulantes au chargement de la page
      document.addEventListener("DOMContentLoaded", function () {
        // Charger les classes
        fetch("get_listes.php?type=classes")
          .then((response) => response.json())
          .then((data) => {
            const select = document.getElementById("classe");
            data.forEach((item) => {
              const option = document.createElement("option");
              option.value = item.id;
              option.textContent = item.nom;
              select.appendChild(option);
            });
          });

        // Charger les professeurs
        fetch("get_listes.php?type=professeurs")
          .then((response) => response.json())
          .then((data) => {
            const select = document.getElementById("professeur");
            data.forEach((item) => {
              const option = document.createElement("option");
              option.value = item.id;
              option.textContent = item.nom;
              select.appendChild(option);
            });
          });

        // Charger les modules
        fetch("get_listes.php?type=modules")
          .then((response) => response.json())
          .then((data) => {
            const select = document.getElementById("module");
            data.forEach((item) => {
              const option = document.createElement("option");
              option.value = item.id;
              option.textContent = item.nom;
              select.appendChild(option);
            });
          });

        // Charger les salles
        fetch("get_listes.php?type=salles")
          .then((response) => response.json())
          .then((data) => {
            const select = document.getElementById("salle");
            data.forEach((item) => {
              const option = document.createElement("option");
              option.value = item.id;
              option.textContent = item.nom;
              select.appendChild(option);
            });
          });
      });

      // Gestion de la soumission du formulaire
      document
        .getElementById("seanceForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const loading = document.getElementById("loading");
          const successMessage = document.getElementById("successMessage");
          const errorMessage = document.getElementById("errorMessage");

          loading.style.display = "block";
          successMessage.style.display = "none";
          errorMessage.style.display = "none";

          // Récupération des données du formulaire
          const formData = new FormData(this);

          // Envoi des données
          fetch("ajouter_seance.php", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.json())
            .then((data) => {
              loading.style.display = "none";
              if (data.success) {
                successMessage.style.display = "block";
                this.reset();
              } else {
                errorMessage.textContent = data.message;
                errorMessage.style.display = "block";
              }
            })
            .catch((error) => {
              loading.style.display = "none";
              errorMessage.textContent =
                "Une erreur est survenue lors de l'enregistrement.";
              errorMessage.style.display = "block";
            });
        });
    </script>
  </body>
</html>
